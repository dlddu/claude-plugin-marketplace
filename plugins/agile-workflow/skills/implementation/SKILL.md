---
name: implementation
description: >
  작업 계획서를 기반으로 TDD 방식으로 구현을 진행합니다.
  구현과 테스트를 동시에 작성하고, GitHub Actions CI 결과로 검증합니다.
  "구현 시작해", "이거 개발해줘", "코드 작성해줘" 등을 요청할 때 활성화됩니다.
---

# 구현 스킬 (Implementation Skill)

## 개요

이 스킬은 작업 계획서를 기반으로 TDD 방식의 구현을 수행합니다:
1. **테스트 우선 작성** - 인수 테스트 → 단위 테스트
2. **구현 진행** - 테스트 통과를 위한 최소 구현
3. **CI 검증** - GitHub Actions 결과 기반 판단
4. **추적성 매트릭스 업데이트**

## 핵심 원칙

### 1. 구현과 테스트는 항상 동시에
- 테스트 없는 구현은 허용되지 않음
- Red → Green → Refactor 사이클 준수
- 각 커밋에는 테스트가 포함되어야 함

### 2. 테스트 실패 시 판단 기준
```
테스트 실패
    ↓
명세(SPEC.md, USER-STORIES.md) 확인
    ↓
┌─────────────────────────────────────┐
│ 명세와 테스트가 일치하는가?          │
└─────────────────────────────────────┘
    │                    │
   YES                   NO
    ↓                    ↓
구현 수정            명세/테스트 재검토
(테스트가 올바름)     (논리적 오류 가능)
```

### 3. CI 기반 검증
- 테스트 통과 여부는 **반드시 GitHub Actions 결과**로 판단
- 로컬 테스트 통과만으로 완료 처리하지 않음
- CI 실패 시 로그 분석 후 수정

## 사전 조건

- 작업 계획서(`docs/plans/PLAN-XXX.md`)가 존재해야 함
- CI 파이프라인(`.github/workflows/ci.yml`)이 설정되어 있어야 함

## 워크플로우

### Phase 1: 작업 계획서 확인

작업 계획서에서 다음 정보를 확인합니다:

```markdown
확인 항목:
- [ ] 작업 ID 및 작업명
- [ ] 관련 인수 테스트 (AC-XXX-X)
- [ ] 테스트 계획 (단위/통합)
- [ ] 수정 대상 파일
- [ ] 기술적 고려사항
```

### Phase 2: 테스트 작성 (Red Phase)

#### 2.1 인수 테스트 작성

인수 기준(AC)을 기반으로 E2E/통합 테스트 작성:

```
AC-001-1:
- Given: 사용자가 로그인 페이지에 있다
- When: 올바른 자격 증명을 입력한다
- Then: 대시보드로 리다이렉트된다

→ 통합 테스트로 변환
```

#### 2.2 단위 테스트 작성

구현할 함수/모듈에 대한 단위 테스트:

```
테스트 작성 순서:
1. 정상 케이스 (Happy Path)
2. 경계 케이스 (Edge Cases)
3. 에러 케이스 (Error Cases)
```

#### 2.3 테스트 실행 확인

```bash
# 테스트 실행 (실패 확인 - Red)
[테스트 실행 명령어]

# 예상 결과: 테스트 실패 (구현 전이므로)
```

### Phase 3: 구현 (Green Phase)

#### 3.1 최소 구현

테스트를 통과하기 위한 **최소한의 코드** 작성:

```
구현 원칙:
- YAGNI: 필요하지 않은 것은 만들지 않음
- KISS: 가장 단순한 방법으로 구현
- 작은 단위로 커밋
```

#### 3.2 로컬 테스트 실행

```bash
# 테스트 실행 (통과 확인 - Green)
[테스트 실행 명령어]

# 예상 결과: 테스트 통과
```

### Phase 4: 리팩토링 (Refactor Phase)

테스트가 통과한 후 코드 품질 개선:

```
리팩토링 체크리스트:
- [ ] 중복 코드 제거
- [ ] 명확한 변수/함수명
- [ ] 적절한 추상화 수준
- [ ] 코드 스타일 일관성
```

**주의**: 리팩토링 후에도 모든 테스트가 통과해야 함

### Phase 5: CI 검증

#### 5.1 변경사항 커밋 및 푸시

```bash
git add .
git commit -m "feat(TASK-XXX): [변경 내용]

- AC-001-1 구현
- 단위 테스트 추가
- 통합 테스트 추가"

git push origin [branch]
```

#### 5.2 GitHub Actions 결과 확인

**CI 검증 스크립트를 사용하여 확인합니다:**

```bash
# CI 상태 확인 스크립트 실행
./scripts/check-ci.sh
```

스크립트는 다음 작업을 자동으로 수행합니다:
- GitHub CLI 설치 및 인증 설정
- 현재 커밋에 대한 모든 워크플로우 조회
- 워크플로우 완료까지 대기 (최대 10분)
- 실패 시 상세 로그 출력

**환경 변수 설정 필요:**
```bash
export GITHUB_TOKEN="your-token"
# 또는
export GH_TOKEN="your-token"
```

**수동 확인이 필요한 경우:**
```bash
# 워크플로우 실행 상태 확인
gh run list --limit 5

# 특정 실행 상세 확인
gh run view [run-id]

# 실패 시 로그 확인
gh run view [run-id] --log-failed
```

#### 5.3 CI 결과 기반 판단

```
CI 결과
    ↓
┌─────────────────────────────────────┐
│ 모든 체크 통과?                      │
└─────────────────────────────────────┘
    │                    │
   YES                   NO
    ↓                    ↓
Phase 6으로           실패 분석
                         ↓
                    ┌────────────┐
                    │ 테스트 실패? │
                    └────────────┘
                      │        │
                    YES       NO
                      ↓        ↓
               Phase 2로    린트/빌드
               (테스트 수정)  오류 수정
```

### Phase 6: 테스트 실패 분석 (실패 시)

테스트가 실패한 경우 다음 절차를 따릅니다:

#### 6.1 명세 대조 확인

```markdown
## 실패 분석 체크리스트

### 1. 명세 확인
- [ ] SPEC.md의 요구사항과 테스트가 일치하는가?
- [ ] USER-STORIES.md의 AC와 테스트가 일치하는가?

### 2. 논리적 오류 확인
- [ ] 테스트의 Given 조건이 명세와 일치하는가?
- [ ] 테스트의 When 행동이 명세와 일치하는가?
- [ ] 테스트의 Then 결과가 명세와 일치하는가?

### 3. 판단
- 명세와 테스트가 일치 → 구현 수정
- 명세와 테스트가 불일치 → 테스트/명세 재검토
```

#### 6.2 수정 방향 결정

| 상황 | 조치 |
|------|------|
| 테스트가 명세와 일치, 구현이 틀림 | **구현 수정** |
| 테스트가 명세와 불일치 | 테스트 수정 후 재검토 |
| 명세 자체에 논리적 오류 | 명세 수정 (spec-writing 스킬 활용) |

### Phase 7: 추적성 매트릭스 업데이트

`docs/TRACEABILITY-MATRIX.md` 업데이트:

```markdown
| 요구사항 ID | 사용자 스토리 | 인수 테스트 | 작업 ID | 구현 상태 | 테스트 상태 |
|------------|--------------|------------|---------|----------|------------|
| REQ-001 | US-001 | AC-001-1 | TASK-001 | ✅ 완료 | ✅ 통과 |
| REQ-001 | US-001 | AC-001-2 | TASK-001 | ✅ 완료 | ✅ 통과 |
```

### Phase 8: 작업 완료 처리

작업 계획서에 완료 표시:

```markdown
# 작업 계획서: PLAN-XXX

## 작업 상태: ✅ 완료

### 완료 일시
- 완료일: YYYY-MM-DD
- CI 실행 ID: [run-id]

### 완료된 항목
- [x] AC-001-1 구현 및 테스트 통과
- [x] AC-001-2 구현 및 테스트 통과
- [x] CI 파이프라인 통과
```

## 산출물 체크리스트

작업 완료 전 다음 항목을 확인하세요:

- [ ] 모든 인수 테스트가 작성됨
- [ ] 모든 단위 테스트가 작성됨
- [ ] 구현이 완료됨
- [ ] 로컬 테스트가 통과함
- [ ] **GitHub Actions CI가 통과함** (필수)
- [ ] 추적성 매트릭스가 업데이트됨
- [ ] 작업 계획서에 완료 표시됨

## CI 검증 스크립트

CI 검증은 `scripts/check-ci.sh` 스크립트를 사용합니다.

### 스크립트 위치
```
plugins/agile-workflow/scripts/check-ci.sh
```

### 사용법
```bash
# 스크립트 실행
./scripts/check-ci.sh
```

### 스크립트 기능
- **자동 gh CLI 설치**: GitHub CLI가 없으면 자동 설치
- **인증 설정**: GITHUB_TOKEN 또는 GH_TOKEN 환경변수 사용
- **모든 워크플로우 모니터링**: 현재 커밋의 모든 워크플로우 추적
- **상세 로그 출력**: 실패 시 jobs 및 steps 정보 표시
- **타임아웃 처리**: 최대 10분 대기

### 종료 코드
| 코드 | 의미 |
|------|------|
| 0 | 모든 워크플로우 성공 |
| 1 | 하나 이상의 워크플로우 실패 |
| 2 | 타임아웃 |

### 환경 변수
```bash
# 필수: GitHub 인증 토큰 (둘 중 하나)
export GITHUB_TOKEN="your-token"
export GH_TOKEN="your-token"

# 선택: 저장소 정보 (자동 감지되지 않는 경우)
export GITHUB_REPOSITORY="owner/repo"
```

## 사용 예시

```
사용자: TASK-001 구현 시작해줘

Claude:
[Phase 1] 작업 계획서 확인...
- 작업: 사용자 로그인 기능
- 관련 AC: AC-001-1, AC-001-2

[Phase 2] 테스트 작성 (Red)...
- tests/integration/auth.test.ts 작성
- tests/unit/login.test.ts 작성
- 테스트 실행: 2개 실패 (예상대로)

[Phase 3] 구현 (Green)...
- src/auth/login.ts 구현
- 테스트 실행: 2개 통과

[Phase 4] 리팩토링...
- 중복 코드 제거
- 테스트 재실행: 2개 통과

[Phase 5] CI 검증...
- 커밋 및 푸시 완료
- ./scripts/check-ci.sh 실행 중...
- Found 2 workflow(s) for commit abc1234
- Progress: 2 completed, 0 pending
- ✅ All workflows completed successfully!

[Phase 6] 추적성 업데이트...
TASK-001 완료!
```

## 관련 스킬

- **task-planning**: 작업 계획 수립 (선행)
- **spec-writing**: 명세 수정 필요 시
- **project-bootstrap**: CI 설정 수정 필요 시
